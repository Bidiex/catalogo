<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - TraeGo</title>
  <link rel="icon" type="image/svg+xml" href="/src/assets/icon_traego.svg" />
  <link rel="stylesheet" href="/src/styles/global.css">
  <link rel="stylesheet" href="/src/pages/dashboard/dashboard.css">
  <link rel="stylesheet" href="/src/pages/dashboard/css/business-layout.css">
  <link rel="stylesheet" href="/src/pages/dashboard/css/delivery-persons.css">
</head>

<body>
  <!-- Dashboard Layout Container -->
  <div class="dashboard-container">
    <!-- Mobile Overlay -->
    <div id="dashboardOverlay" class="dashboard-overlay"></div>

    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
      <!-- Logo Section -->
      <div class="sidebar-logo">
        <div class="logo-icon">
          <img src="/src/assets/icon_traego.svg" alt="Traego" style="width: 40px; height: 40px; object-fit: contain;">
        </div>
        <div class="logo-text">
          <h2>Mi Cat√°logo</h2>
          <p id="businessBranchName" class="branch-name">Panel de control</p>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-section="dashboard">
          <i class="ri-dashboard-line"></i>
          <span>Dashboard</span>
        </a>
        <div class="nav-section-divider">
          <span>GESTI√ìN</span>
        </div>
        <a href="#" class="nav-item" data-section="orders">
          <i class="ri-file-list-3-line"></i>
          <span>Pedidos</span>
        </a>
        <a href="#" class="nav-item" data-section="business">
          <i class="ri-building-line"></i>
          <span>Mi Negocio</span>
        </a>
        <a href="#" class="nav-item" data-section="delivery-persons">
          <i class="ri-motorbike-line"></i>
          <span>Domiciliarios</span>
        </a>

        <a href="#" class="nav-item" data-section="products">
          <i class="ri-shopping-bag-line"></i>
          <span>Productos</span>
        </a>
        <a href="#" class="nav-item" data-section="promotions">
          <i class="ri-price-tag-3-line"></i>
          <span>Promociones</span>
        </a>
        <a href="#" class="nav-item" data-section="whatsapp">
          <i class="ri-whatsapp-line"></i>
          <span>WhatsApp</span>
        </a>
        <a href="#" class="nav-item" data-section="support">
          <i class="ri-customer-service-2-line"></i>
          <span>Soporte</span>
        </a>
      </nav>

      <!-- User Section -->
      <div class="sidebar-user">
        <div class="user-info">
          <div class="user-avatar">
            <i class="ri-user-line"></i>
          </div>
          <div class="user-details">
            <span id="userEmail" class="user-name"></span>
            <span class="user-role">Propietario</span>
          </div>
        </div>
        <button id="logoutBtn" class="btn-logout">
          <i class="ri-logout-box-line"></i>
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="dashboard-content">
      <!-- Top Header Bar -->
      <header class="dashboard-header">
        <div class="header-content">
          <button id="mobileMenuBtn" class="mobile-menu-btn">
            <i class="ri-menu-line"></i>
          </button>
          <h1 id="pageTitle">Dashboard</h1>
          <div class="header-actions">
            <button id="editBusinessBtn" class="btn-header-action" style="display: none;">
              <i class="ri-edit-line"></i>
              <span>Editar Negocio</span>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="dashboard-main">

        <!-- Loading Modal -->
        <div id="loadingState" class="loading-modal">
          <div class="loading-modal-content">
            <div class="loading-spinner-container">
              <div class="loading-logo" id="dashboardLoadingLogo">
                <i class="ri-store-2-line"></i>
              </div>
              <div class="loading-spinner-ring"></div>
            </div>
            <h2>Cargando panel</h2>
            <p>Por favor espera un momento...</p>
          </div>
        </div>

        <!-- Operational Alert (Dynamic) -->
        <div id="operationalAlert" class="operational-alert" style="display: none;">
          <div class="alert-icon">
            <i class="ri-alert-fill"></i>
          </div>
          <div class="alert-content">
            <h3>¬°Atenci√≥n! Tu negocio no est√° listo para vender</h3>
            <p id="operationalAlertText">Debes configurar...</p>
          </div>
          <button id="operationalAlertBtn" class="btn-primary-small">
            Configurar Ahora <i class="ri-arrow-right-line"></i>
          </button>
        </div>

        <!-- No business state (primer uso) - NUEVO ONBOARDING -->
        <div id="noBusinessState" class="no-business-state" style="display: none;">
          <div class="onboarding-wizard">

            <!-- Progress indicator -->
            <div class="wizard-progress">
              <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <span>Negocio</span>
              </div>
              <div class="progress-line"></div>
              <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <span>Categor√≠as</span>
              </div>
              <div class="progress-line"></div>
              <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <span>Producto</span>
              </div>
              <div class="progress-line"></div>
              <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <span>Listo</span>
              </div>
            </div>

            <!-- Step 1: Business -->
            <div class="wizard-step" id="wizard-step-1">
              <div class="wizard-header">
                <i class="ri-store-2-line wizard-icon"></i>
                <h2>Informaci√≥n de tu negocio</h2>
                <p>Completa los datos b√°sicos para comenzar</p>
              </div>

              <form class="wizard-form" id="wizardBusinessForm">
                <!-- Logo Upload -->
                <div class="form-group">
                  <label>Logo del negocio (opcional)</label>
                  <div class="image-upload-container">
                    <div class="image-preview" id="wiz-logo-preview">
                      <i class="ri-image-line"></i>
                      <p>Click para seleccionar logo</p>
                      <small>JPG, PNG o WEBP (m√°x. 2MB)</small>
                    </div>
                    <input type="file" id="wiz-logo-input" accept="image/jpeg,image/jpg,image/png,image/webp"
                      style="display: none;">
                    <div class="image-upload-actions" id="wiz-logo-actions" style="display: none;">
                      <button type="button" class="btn-secondary-small" id="wiz-change-logo">
                        <i class="ri-image-edit-line"></i> Cambiar logo
                      </button>
                      <button type="button" class="btn-secondary-small danger" id="wiz-remove-logo">
                        <i class="ri-delete-bin-line"></i> Eliminar
                      </button>
                    </div>
                    <div class="image-upload-progress" id="wiz-logo-progress" style="display: none;">
                      <div class="progress-bar">
                        <div class="progress-fill"></div>
                      </div>
                      <p>Subiendo logo...</p>
                    </div>
                  </div>
                  <input type="hidden" id="wiz-logo-url-hidden">
                </div>

                <div class="form-group">
                  <label for="wiz-business-name">Nombre del negocio *</label>
                  <input type="text" id="wiz-business-name" placeholder="Ej: Burger Master" required>
                </div>

                <div class="form-group">
                  <label for="wiz-whatsapp">WhatsApp *</label>
                  <input type="tel" id="wiz-whatsapp" placeholder="+573001234567" required>
                  <small>Incluye c√≥digo de pa√≠s (+57 para Colombia)</small>
                </div>

                <div class="form-group">
                  <label for="wiz-address">Direcci√≥n del negocio (opcional)</label>
                  <input type="text" id="wiz-address" placeholder="Ej: Calle 123 # 45-67">
                </div>

                <div class="form-group">
                  <label for="wiz-description">Descripci√≥n</label>
                  <textarea id="wiz-description" rows="2" placeholder="Describe tu negocio..."></textarea>
                </div>

                <button type="submit" class="btn-primary btn-block">
                  Continuar <i class="ri-arrow-right-line"></i>
                </button>
              </form>
            </div>

            <!-- Step 2: Categories -->
            <div class="wizard-step" id="wizard-step-2" style="display: none;">
              <div class="wizard-header">
                <i class="ri-folder-line wizard-icon"></i>
                <h2>Agrega categor√≠as</h2>
                <p>Organiza tus productos (opcional)</p>
              </div>

              <div class="wizard-content">
                <div class="category-input-group">
                  <input type="text" id="wiz-category-input" placeholder="Ej: Hamburguesas, Bebidas...">
                  <button type="button" id="wiz-add-category" class="btn-primary">
                    <i class="ri-add-line"></i>
                  </button>
                </div>

                <div id="wiz-categories-display" class="categories-display">
                  <!-- Se llenar√°n con JS -->
                </div>

                <div class="wizard-actions">
                  <button type="button" id="wiz-skip-categories" class="btn-secondary">
                    Omitir
                  </button>
                  <button type="button" id="wiz-continue-categories" class="btn-primary">
                    Continuar <i class="ri-arrow-right-line"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 3: Product -->
            <div class="wizard-step" id="wizard-step-3" style="display: none;">
              <div class="wizard-header">
                <i class="ri-shopping-bag-line wizard-icon"></i>
                <h2>Primer producto</h2>
                <p>Agrega tu primer producto (opcional)</p>
              </div>

              <div class="wizard-content">
                <form class="wizard-form" id="wizardProductForm">
                  <div class="form-group">
                    <label for="wiz-product-name">Nombre del producto</label>
                    <input type="text" id="wiz-product-name" placeholder="Ej: Hamburguesa Cl√°sica">
                  </div>

                  <div class="form-group">
                    <label for="wiz-product-price">Precio</label>
                    <input type="number" id="wiz-product-price" step="0.01" min="0" placeholder="0.00">
                  </div>

                  <div class="form-group" id="wiz-product-category-group" style="display: none;">
                    <label for="wiz-product-category">Categor√≠a</label>
                    <select id="wiz-product-category">
                      <option value="">Sin categor√≠a</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="wiz-product-description">Descripci√≥n</label>
                    <textarea id="wiz-product-description" rows="2" placeholder="Describe el producto..."></textarea>
                  </div>
                </form>

                <div class="wizard-actions">
                  <button type="button" id="wiz-skip-product" class="btn-secondary">
                    Omitir
                  </button>
                  <button type="button" id="wiz-continue-product" class="btn-primary">
                    Finalizar <i class="ri-check-line"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 4: Success -->
            <div class="wizard-step" id="wizard-step-4" style="display: none;">
              <div class="wizard-header success">
                <i class="ri-checkbox-circle-line wizard-icon"></i>
                <h2>¬°Todo listo! üéâ</h2>
                <p>Tu negocio est√° configurado</p>
              </div>

              <div class="wizard-content">
                <div class="success-summary">
                  <div class="summary-item">
                    <i class="ri-store-2-line"></i>
                    <div>
                      <strong>Negocio creado</strong>
                      <p id="summary-business-name">-</p>
                    </div>
                  </div>
                  <div class="summary-item" id="summary-categories-box" style="display: none;">
                    <i class="ri-folder-line"></i>
                    <div>
                      <strong>Categor√≠as</strong>
                      <p id="summary-categories-text">-</p>
                    </div>
                  </div>
                  <div class="summary-item" id="summary-product-box" style="display: none;">
                    <i class="ri-shopping-bag-line"></i>
                    <div>
                      <strong>Producto</strong>
                      <p id="summary-product-text">-</p>
                    </div>
                  </div>
                </div>

                <button type="button" id="wiz-finish" class="btn-primary btn-block">
                  Ir al Dashboard <i class="ri-arrow-right-line"></i>
                </button>
              </div>
            </div>

          </div>
        </div>

        <!-- Business exists state -->
        <div id="businessExistsState" class="business-state" style="display: none;">

          <!-- Section: Dashboard (Default) -->
          <div id="section-dashboard" class="dashboard-section active">
            <div class="stats-grid">
              <!-- Total Categor√≠as Card -->
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                  <i class="ri-folder-line"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Total Categor√≠as</div>
                  <div class="stat-value" id="statTotalCategories">0</div>
                </div>
              </div>

              <!-- Total Productos Card -->
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(37, 200, 37, 0.1); color: var(--color-primary);">
                  <i class="ri-shopping-bag-line"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Total Productos</div>
                  <div class="stat-value" id="statTotalProducts">0</div>
                </div>
              </div>

              <!-- Visitas al Cat√°logo Card -->
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                  <i class="ri-eye-line"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Visitas al Cat√°logo</div>
                  <div class="stat-value" id="statCatalogVisits">0</div>
                </div>
              </div>

              <!-- Top 3 Productos M√°s Gustados Card -->
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(236, 72, 153, 0.1); color: #ec4899;">
                  <i class="ri-heart-fill"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Top 3 M√°s Gustados</div>
                  <div class="top-3-list" id="statTop3Products">
                    <p style="color: #9ca3af; font-size: 0.85rem;">Cargando...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-container" style="margin-top: 2rem; border-top: 1px solid #e2e8f0; padding-top: 2rem;">
              <h2 style="font-size: 1.25rem; color: #1e293b; margin-bottom: 1rem; font-weight: 600;">Estad√≠sticas del
                Negocio</h2>

              <!-- BI Filters -->
              <div class="analytics-filters card" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.9rem; color: #64748b; margin-bottom: 1rem; font-weight: 600;">Filtrar
                  Estad√≠sticas</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">

                  <!-- Year -->
                  <div class="form-group" style="margin-bottom: 0;">
                    <label for="bi-filter-year" style="font-size: 0.85rem; font-weight: 500;">A√±o</label>
                    <div class="select-wrapper" style="position: relative;">
                      <select id="bi-filter-year" class="form-input"
                        style="width: 100%; cursor: pointer; padding-left: 2.5rem; padding-right: 1rem;">
                        <option value="all">Todo el tiempo</option>
                      </select>
                      <i class="ri-calendar-line"
                        style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #9ca3af;"></i>
                    </div>
                  </div>

                  <!-- Month -->
                  <div class="form-group" style="margin-bottom: 0;">
                    <label for="bi-filter-month" style="font-size: 0.85rem; font-weight: 500;">Mes</label>
                    <div class="select-wrapper" style="position: relative;">
                      <select id="bi-filter-month" class="form-input"
                        style="width: 100%; cursor: pointer; padding-left: 2.5rem; padding-right: 1rem;">
                        <option value="all">Todos los meses</option>
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                      </select>
                      <i class="ri-calendar-event-line"
                        style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #9ca3af;"></i>
                    </div>
                  </div>

                  <!-- Day of Week -->
                  <div class="form-group" style="margin-bottom: 0;">
                    <label for="bi-filter-day" style="font-size: 0.85rem; font-weight: 500;">D√≠a</label>
                    <div class="select-wrapper" style="position: relative;">
                      <select id="bi-filter-day" class="form-input"
                        style="width: 100%; cursor: pointer; padding-left: 2.5rem; padding-right: 1rem;">
                        <option value="all">Todos los d√≠as</option>
                        <option value="1">Lunes</option>
                        <option value="2">Martes</option>
                        <option value="3">Mi√©rcoles</option>
                        <option value="4">Jueves</option>
                        <option value="5">Viernes</option>
                        <option value="6">S√°bado</option>
                        <option value="0">Domingo</option>
                      </select>
                      <i class="ri-calendar-check-line"
                        style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #9ca3af;"></i>
                    </div>
                  </div>

                  <!-- Category -->
                  <div class="form-group" style="margin-bottom: 0;">
                    <label for="bi-filter-category" style="font-size: 0.85rem; font-weight: 500;">Categor√≠a</label>
                    <div class="select-wrapper" style="position: relative;">
                      <select id="bi-filter-category" class="form-input"
                        style="width: 100%; cursor: pointer; padding-left: 2.5rem; padding-right: 1rem;">
                        <option value="all">Todas las categor√≠as</option>
                      </select>
                      <i class="ri-folder-line"
                        style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #9ca3af;"></i>
                    </div>
                  </div>

                  <!-- Status -->
                  <div class="form-group" style="margin-bottom: 0;">
                    <label for="bi-filter-status" style="font-size: 0.85rem; font-weight: 500;">Estado</label>
                    <div class="select-wrapper" style="position: relative;">
                      <select id="bi-filter-status" class="form-input"
                        style="width: 100%; cursor: pointer; padding-left: 2.5rem; padding-right: 1rem;">
                        <option value="all">Todos los estados</option>
                        <option value="completed">Completados</option>
                        <option value="dispatched">Despachados</option>
                        <option value="verified">Verificados</option>
                        <option value="pending">Pendientes</option>
                        <option value="cancelled">Cancelados</option>
                      </select>
                      <i class="ri-checkbox-circle-line"
                        style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #9ca3af;"></i>
                    </div>
                  </div>
                </div>
              </div>

              <!-- BI Cards -->
              <div class="analytics-stats-grid">
                <!-- Card: Orders -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
                    <i class="ri-file-list-3-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Pedidos</div>
                    <div class="stat-value" id="bi-total-orders">-</div>
                  </div>
                </div>
                <!-- Card: Sales -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                    <i class="ri-money-dollar-circle-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Ventas</div>
                    <div class="stat-value" id="bi-total-sales">-</div>
                  </div>
                </div>
                <!-- Card: Avg Ticket -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                    <i class="ri-price-tag-3-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Ticket Promedio</div>
                    <div class="stat-value" id="bi-avg-ticket">-</div>
                  </div>
                </div>

                <!-- Card: Total Delivery -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                    <i class="ri-bike-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Total Domicilios</div>
                    <div class="stat-value" id="bi-total-delivery">-</div>
                  </div>
                </div>
                <!-- Card: Most Sold Product -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(236, 72, 153, 0.1); color: #ec4899;">
                    <i class="ri-trophy-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Producto m√°s pedido</div>
                    <div class="stat-value-small" id="bi-most-sold-product">-</div>
                  </div>
                </div>

                <!-- Card: Payment Method -->
                <div class="stat-card">
                  <div class="stat-icon" style="background: rgba(14, 165, 233, 0.1); color: #0ea5e9;">
                    <i class="ri-bank-card-line"></i>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">M√©todo de pago m√°s usado</div>
                    <div class="stat-value-small" id="bi-payment-method">-</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- BI Charts -->
            <div class="analytics-charts-grid" style="display: flex; flex-direction: column; gap: 1.5rem;">
              <!-- Row 1 -->
              <div class="charts-row">
                <div class="card chart-card" style="padding: 1.5rem; height: 400px;">
                  <div class="chart-loader" id="loader-orders">
                    <div class="spinner"></div>
                  </div>
                  <div id="bi-chart-orders" style="width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s;">
                  </div>
                </div>
                <div class="card chart-card" style="padding: 1.5rem; height: 400px;">
                  <div class="chart-loader" id="loader-sales">
                    <div class="spinner"></div>
                  </div>
                  <div id="bi-chart-sales" style="width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s;">
                  </div>
                </div>
              </div>
              <!-- Row 2 -->
              <div class="charts-row">
                <div class="card chart-card" style="padding: 1.5rem; height: 400px;">
                  <div class="chart-loader" id="loader-category">
                    <div class="spinner"></div>
                  </div>
                  <div id="bi-chart-category" style="width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s;">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Delivery Persons (Domiciliarios) -->
        <div id="section-delivery-persons" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-motorbike-line"></i> Gesti√≥n de Domiciliarios</h2>
              <button id="addDeliveryPersonBtn" class="btn-primary-small">
                <i class="ri-add-line"></i> Nuevo Domiciliario
              </button>
            </div>

            <div class="card-content">
              <div class="delivery-persons-controls">
                <div class="search-delivery-input">
                  <i class="ri-search-line"></i>
                  <input type="text" id="searchDeliveryInput" placeholder="Buscar por nombre o c√≥digo...">
                </div>

                <div id="filterVehiclePills" class="filter-pills">
                  <button class="filter-pill active" data-vehicle="all">Todos</button>
                  <button class="filter-pill" data-vehicle="moto">Moto</button>
                  <button class="filter-pill" data-vehicle="bicicleta">Bicicleta</button>
                  <button class="filter-pill" data-vehicle="moto_electrica">Moto El√©ctrica</button>
                  <button class="filter-pill" data-vehicle="ciclomotor">Ciclomotor</button>
                  <button class="filter-pill" data-vehicle="carro">Carro</button>
                </div>
              </div>

              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>C√≥digo</th>
                      <th>Nombre</th>
                      <th>Veh√≠culo</th>
                      <th>Estado</th>
                      <th>Total Domicilios</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="deliveryPersonsTableBody">
                    <!-- JS generated rows -->
                  </tbody>
                </table>
              </div>

              <div id="noDeliveryPersonsState" class="empty-message"
                style="display: none; text-align: center; padding: 2rem; color: #6b7280;">
                No tienes domiciliarios registrados.
              </div>
            </div>
          </section>
        </div>

        <!-- Section: Mi Negocio -->
        <div id="section-business" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-building-line"></i> Mi Negocio</h2>
            </div>
            <div class="card-content">
              <div class="business-info">

                <div class="business-profile-container" style="display: flex; flex-direction: column; gap: 1.5rem;">

                  <!-- Top: Identity (Logo + Info) + Plan -->
                  <!-- We will use a grid/flex wrapper via CSS class 'business-top-grid' -->
                  <div class="business-top-grid">

                    <!-- Identity Side -->
                    <div class="logo-display-container" style="display: flex; flex-direction: column; gap: 1rem;">
                      <!-- Logo & Buttons -->
                      <div style="display: flex; flex-direction: column; align-items: center;">
                        <div class="image-preview" id="business-logo-display"
                          style="width: 150px; height: 150px; margin-bottom: 1rem; border-radius: 50%; overflow: hidden; background: #f3f4f6; display: flex; align-items: center; justify-content: center; border: 2px solid #e5e7eb; cursor: pointer;">
                          <i class="ri-store-2-line" style="font-size: 3rem; color: #9ca3af;"></i>
                        </div>
                        <input type="file" id="business-logo-input" accept="image/jpeg,image/jpg,image/png,image/webp"
                          style="display: none;">
                        <button type="button" id="changeBusinessLogoBtn" class="btn-secondary-small">
                          <i class="ri-image-edit-line"></i> Cambiar Logo
                        </button>

                        <button type="button" id="openColorModalBtn" class="btn-secondary-small"
                          style="margin-top: 0.5rem; background: white; border: 1px solid #e2e8f0;">
                          <i class="ri-palette-line"></i> Personalizar Color
                        </button>
                        <div id="logo-upload-progress" style="display: none; width: 150px; margin-top: 0.5rem;">
                          <div class="progress-bar"
                            style="height: 4px; background: #eee; border-radius: 2px; overflow: hidden;">
                            <div class="progress-fill"
                              style="height: 100%; background: var(--primary-color); width: 0%;">
                            </div>
                          </div>
                        </div>
                      </div>


                      <!-- Header Background Image Section -->
                      <div class="header-background-section">
                        <h3 class="section-subtitle">
                          <i class="ri-image-2-line"></i> Imagen de Fondo del Header
                        </h3>
                        <p class="section-description">
                          Personaliza el fondo del header de tu cat√°logo para darle un toque √∫nico
                        </p>

                        <div class="resolution-tip"
                          style="background: #eff6ff; border-left: 3px solid var(--color-primary); padding: 0.75rem; margin-bottom: 1rem; border-radius: 4px;">
                          <p style="margin: 0; font-size: 0.85rem; color: #1e40af;">
                            <i class="ri-lightbulb-line" style="margin-right: 0.25rem;"></i>
                            <strong>Recomendaci√≥n:</strong> Usa una imagen de <strong>1200x400 p√≠xeles</strong> para
                            mejores resultados. Formatos: JPG, PNG o WEBP (m√°x. 2MB).
                          </p>
                        </div>

                        <div class="header-bg-preview" id="header-bg-preview">
                          <i class="ri-landscape-line"></i>
                          <p>Sin imagen de fondo</p>
                          <small>Tama√±o recomendado: 1200x400px</small>
                        </div>

                        <input type="file" id="header-bg-input" accept="image/jpeg,image/jpg,image/png,image/webp"
                          style="display: none;">

                        <div class="header-bg-actions">
                          <button type="button" id="uploadHeaderBgBtn" class="btn-secondary-small">
                            <i class="ri-upload-2-line"></i> Subir imagen
                          </button>
                          <button type="button" id="removeHeaderBgBtn" class="btn-secondary-small danger"
                            style="display: none;">
                            <i class="ri-delete-bin-line"></i> Eliminar
                          </button>
                        </div>

                        <div id="header-bg-upload-progress" class="upload-progress-bar" style="display: none;">
                          <div class="progress-bar">
                            <div class="progress-fill"></div>
                          </div>
                          <p>Subiendo imagen...</p>
                        </div>
                      </div>

                      <!-- Info Rows (Moved Here) -->
                      <div class="business-details-list" style="margin-top: 1rem;">
                        <div class="info-row">
                          <span class="label"><i class="ri-store-line"></i> Nombre:</span>
                          <span id="businessName" class="value">-</span>
                        </div>
                        <div class="info-row">
                          <span class="label"><i class="ri-file-text-line"></i> Descripci√≥n:</span>
                          <span id="businessDescription" class="value"
                            style="font-style: italic; color: #6b7280;">-</span>
                        </div>
                        <div class="info-row">
                          <span class="label"><i class="ri-whatsapp-line"></i> WhatsApp:</span>
                          <span id="businessWhatsapp" class="value">-</span>
                        </div>
                        <div class="info-row">
                          <span class="label"><i class="ri-map-pin-line"></i> Direcci√≥n:</span>
                          <span id="businessAddress" class="value">-</span>
                        </div>
                        <div class="info-row">
                          <span class="label"><i class="ri-e-bike-2-fill"></i> Precio domicilio:</span>
                          <span id="businessDeliveryPrice" class="value">-</span>
                        </div>
                        <div class="info-row">
                          <span class="label"><i class="ri-link"></i> Enlace del cat√°logo:</span>
                          <div class="catalog-link">
                            <a id="catalogLink" href="#" target="_blank" class="link">-</a>
                            <button id="copyLinkBtn" class="btn-copy">
                              <i class="ri-file-copy-line"></i> Copiar
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Plan Status Side -->
                    <div class="plan-status-section"
                      style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; height: fit-content;">
                      <div
                        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <div>
                          <span class="label"
                            style="display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 0.25rem;">Tu Plan
                            Actual</span>
                          <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span id="planBadge" class="badge"
                              style="background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 99px; font-weight: 600; font-size: 0.9rem;">LOADING...</span>
                            <span id="planStatusTag"
                              style="font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; background: #dcfce7; color: #166534;">Activo</span>
                          </div>
                        </div>
                        <div style="text-align: right;">
                          <span class="label"
                            style="display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 0.25rem;">Vence
                            en</span>
                          <span id="planDaysRemaining" style="font-weight: 600; font-size: 1.1rem; color: #334155;">-
                            d√≠as</span>
                          <div id="planExpiryDate" style="font-size: 0.75rem; color: #94a3b8;">-</div>
                        </div>
                      </div>

                      <!-- Usage Meter -->
                      <div class="usage-meter" style="margin-top: 1rem;">
                        <div
                          style="display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.85rem;">
                          <span style="color: #64748b;">Productos usados</span>
                          <span id="productUsageText" style="font-weight: 600;">0 / 50</span>
                        </div>
                        <div style="height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                          <div id="productUsageBar"
                            style="height: 100%; background: var(--primary-color); width: 0%; transition: width 0.3s ease;">
                          </div>
                        </div>
                        <div id="upgradeMessage" style="display: none; margin-top: 0.5rem;">
                          <button id="btnUpgradePlan" class="btn-primary-small"
                            style="width: 100%; justify-content: center; background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                            <i class="ri-rocket-line"></i> Mejorar a PRO
                          </button>
                        </div>
                        <!-- Bot√≥n Permanente de Upgrade -->
                        <div id="permanentUpgradeContainer"
                          style="display: none; margin-top: 1rem; border-top: 1px dashed #e2e8f0; padding-top: 0.75rem;">
                          <button id="btnPermanentUpgrade" class="btn-secondary-small"
                            style="width: 100%; justify-content: center; color: #4338ca; border-color: #c7d2fe; background: #e0e7ff; cursor: pointer;">
                            <i class="ri-rocket-line"></i> Mejorar mi Plan a PRO
                          </button>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Grid Container for Payment & Hours -->
          <div class="business-settings-grid">

            <!-- Payment Methods Section -->
            <section class="card" style="height: 100%;">
              <div class="card-header">
                <h2><i class="ri-bank-card-line"></i> M√©todos de Pago</h2>
                <button id="addPaymentMethodBtn" class="btn-primary-small">
                  <i class="ri-add-line"></i> Agregar
                </button>
              </div>
              <div class="card-content">
                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1rem;">
                  Configura los m√©todos de pago que tus clientes podr√°n seleccionar al hacer un pedido.
                </p>
                <div id="paymentMethodsList" class="payment-methods-list">
                  <p class="empty-message">No hay m√©todos de pago configurados</p>
                </div>
              </div>
            </section>

            <!-- Business Hours Section -->
            <section class="card" style="height: 100%;">
              <div class="card-header">
                <h2><i class="ri-time-line"></i> Horarios de Servicio</h2>
                <button id="saveBusinessHoursBtn" class="btn-primary-small">
                  <i class="ri-save-line"></i> Guardar Horarios
                </button>
              </div>
              <div class="card-content">
                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1.5rem;">
                  Configura los horarios en que tu negocio est√° abierto. Los clientes solo podr√°n hacer pedidos
                  durante
                  estos horarios.
                </p>
                <div id="businessHoursGrid" class="business-hours-grid">
                  <!-- Se llenar√° din√°micamente con JavaScript -->
                </div>
              </div>
            </section>

          </div>
        </div>

        <!-- Section: Pedidos (Gestion de Ordenes) -->
        <div id="section-orders" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-file-list-3-line"></i> Gesti√≥n de Pedidos</h2>
              <div class="header-controls" style="display: flex; gap: 0.5rem; align-items: center;">
                <button id="openExportModalBtn" class="btn-secondary-small" title="Descargar Reporte"
                  style="height: 36px;">
                  <i class="ri-download-2-line"></i> <span class="hide-mobile" style="display: none;">Exportar</span>
                </button>
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="table"><i class="ri-table-line"></i></button>
                  <button class="view-toggle-btn" data-view="mosaic"><i class="ri-grid-fill"></i></button>
                </div>
              </div>
            </div>
            <div class="card-content">
              <!-- Search & Filter -->
              <div class="search-bar-container" style="display:flex; gap: 1rem; flex-wrap:wrap; margin-bottom: 1.5rem;">
                <div class="search-bar" style="flex:1;">
                  <i class="ri-search-line"></i>
                  <input type="text" id="searchOrdersInput" placeholder="Buscar por nombre, tel√©fono..." />
                  <button id="clearOrdersSearch" class="search-clear" style="display: none;"><i
                      class="ri-close-line"></i></button>
                </div>
                <div id="filterOrdersPills" class="filter-pills">
                  <button class="filter-pill active" data-status="all">Todos</button>
                  <button class="filter-pill" data-status="pending">Pendientes</button>
                  <button class="filter-pill" data-status="verified">Verificados</button>
                  <button class="filter-pill" data-status="dispatched">Despachados</button>
                  <button class="filter-pill" data-status="completed">Completados</button>
                  <button class="filter-pill" data-status="cancelled">Cancelados</button>
                </div>
              </div>

              <!-- Orders List -->
              <div id="ordersListContainer" class="orders-list-container table-view">
                <div class="table-responsive table-container">
                  <table class="data-table" id="ordersTable" style="width: 100%;">
                    <thead>
                      <tr>
                        <th>Fecha</th>
                        <th>Cliente</th>
                        <th>Direcci√≥n</th>
                        <th>Total</th>
                        <th>Estado</th>
                        <th style="text-align: right;">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                      <!-- Filled by JS -->
                    </tbody>
                  </table>
                </div>
                <div id="ordersMosaicGrid" class="orders-mosaic-grid"
                  style="display:none; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                  <!-- Filled by JS -->
                </div>
              </div>

              <p id="noOrdersMessage" class="empty-message"
                style="display:none; text-align: center; padding: 2rem; color: #6b7280;">No hay pedidos registrados.
              </p>

              <!-- Pagination Controls -->
              <div id="ordersPagination" class="pagination-controls" style="display: none;">
                <div style="font-size: 0.9rem; color: #6b7280;">
                  Mostrando <span id="ordersStartCount">0</span> - <span id="ordersEndCount">0</span> de <span
                    id="ordersTotalCount">0</span> pedidos
                </div>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <button id="prevOrdersPageBtn" class="btn-secondary-small" disabled>
                    <i class="ri-arrow-left-s-line"></i> Anterior
                  </button>
                  <span id="ordersPageIndicator"
                    style="display: flex; align-items: center; padding: 0 0.5rem; font-weight: 500; font-size: 0.9rem;">
                    P√°gina 1
                  </span>
                  <button id="nextOrdersPageBtn" class="btn-secondary-small" disabled>
                    Siguiente <i class="ri-arrow-right-s-line"></i>
                  </button>
                </div>
              </div>
            </div>
          </section>
        </div>



        <!-- Section: Productos (Tabs: Productos, Categor√≠as, Men√∫s) -->
        <div id="section-products" class="dashboard-section" style="display: none;">
          <section class="card">

            <!-- Custom Tabs Header -->
            <div class="products-tabs-header">
              <button class="products-tab-btn active" data-tab="products">
                <i class="ri-shopping-bag-line"></i> Productos
              </button>
              <button class="products-tab-btn" data-tab="categories">
                <i class="ri-folder-line"></i> Categor√≠as
              </button>
              <button class="products-tab-btn" data-tab="menus">
                <i class="ri-calendar-event-line"></i> Men√∫s del d√≠a
              </button>
            </div>

            <div class="card-content" style="padding-top: 1.5rem;">

              <!-- Tab Content: Productos -->
              <div id="tab-products" class="products-tab-content active">
                <div class="tab-header-actions"
                  style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                  <h3 style="margin: 0; font-size: 1.1rem;">Gestionar Productos</h3>
                  <button id="addProductBtn" class="btn-primary-small">
                    <i class="ri-add-line"></i> Nuevo Producto
                  </button>
                </div>

                <!-- Search Bar -->
                <div class="search-bar-container">
                  <div class="search-bar">
                    <i class="ri-search-line"></i>
                    <input type="text" id="searchProductsInput" placeholder="Buscar productos..." />
                    <button id="clearProductsSearch" class="search-clear" style="display: none;">
                      <i class="ri-close-line"></i>
                    </button>
                  </div>
                </div>
                <div id="productsList" class="products-list">
                  <p class="empty-message">No hay productos a√∫n</p>
                </div>
              </div>

              <!-- Tab Content: Categor√≠as -->
              <div id="tab-categories" class="products-tab-content" style="display: none;">
                <div class="tab-header-actions"
                  style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                  <h3 style="margin: 0; font-size: 1.1rem;">Gestionar Categor√≠as</h3>
                  <button id="addCategoryBtn" class="btn-primary-small">
                    <i class="ri-add-line"></i> Nueva Categor√≠a
                  </button>
                </div>

                <div class="search-bar-container">
                  <div class="search-bar">
                    <i class="ri-search-line"></i>
                    <input type="text" id="searchCategoriesInput" placeholder="Buscar categor√≠as..." />
                    <button id="clearCategoriesSearch" class="search-clear" style="display: none;">
                      <i class="ri-close-line"></i>
                    </button>
                  </div>
                </div>
                <div id="categoriesList" class="categories-list">
                  <p class="empty-message">No hay categor√≠as a√∫n</p>
                </div>
              </div>

              <!-- Tab Content: Men√∫s del D√≠a -->
              <div id="tab-menus" class="products-tab-content" style="display: none;">
                <div class="tab-header-actions"
                  style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                  <h3 style="margin: 0; font-size: 1.1rem;">Men√∫s del D√≠a</h3>
                  <button id="addDailyMenuBtn" class="btn-primary-small">
                    <i class="ri-add-line"></i> Nuevo Men√∫
                  </button>
                </div>

                <div class="info-alert"
                  style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 1rem; margin-bottom: 1.5rem;">
                  <p style="margin: 0; font-size: 0.9rem; color: #1e40af;">
                    <i class="ri-information-line"></i> <strong>¬øC√≥mo funciona?</strong>
                    Crea diferentes men√∫s (ej: Lunes, Martes, Especial) y activa solo uno a la vez.
                    El men√∫ activo aparecer√° destacado al inicio de tu cat√°logo.
                  </p>
                </div>

                <div id="dailyMenusList" class="daily-menus-grid">
                  <!-- JS Generated -->
                  <p class="empty-message">No hay men√∫s creados</p>
                </div>
              </div>

            </div>
          </section>
        </div>

        <!-- Section: Promociones -->
        <div id="section-promotions" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-price-tag-3-line"></i> Promociones y Combos</h2>
              <button id="addPromotionBtn" class="btn-primary-small">
                <i class="ri-add-line"></i> Agregar
              </button>
            </div>
            <div class="card-content">
              <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1.5rem;">
                Crea banners promocionales que aparecer√°n en la parte superior de tu cat√°logo.
              </p>
              <div id="promotionsList" class="promotions-list">
                <p class="empty-message">No hay promociones activas</p>
              </div>
            </div>
          </section>
        </div>


        <!-- Section: WhatsApp -->
        <div id="section-whatsapp" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-whatsapp-line"></i> Mensaje de WhatsApp</h2>
            </div>
            <div class="card-content">
              <div class="whatsapp-template-editor">
                <div class="template-help">
                  <p><strong>Personaliza el mensaje que se enviar√° por WhatsApp</strong></p>
                  <p class="help-text">Usa los tokens para insertar informaci√≥n din√°mica del pedido:</p>
                </div>

                <div class="tokens-grid">
                  <button class="token-chip" data-token="{productos}" title="Lista de productos del pedido">
                    <i class="ri-shopping-basket-line"></i> {productos}
                  </button>
                  <button class="token-chip" data-token="{total}" title="Total del pedido">
                    <i class="ri-money-dollar-circle-line"></i> {total}
                  </button>
                  <button class="token-chip" data-token="{valor de domicilio}" title="Costo del domicilio">
                    <i class="ri-truck-line"></i> {valor de domicilio}
                  </button>
                  <button class="token-chip" data-token="{nombre}" title="Nombre del cliente">
                    <i class="ri-user-line"></i> {nombre}
                  </button>
                  <button class="token-chip" data-token="{direccion}" title="Direcci√≥n de entrega">
                    <i class="ri-map-pin-line"></i> {direccion}
                  </button>
                  <button class="token-chip" data-token="{telefono}" title="Tel√©fono del cliente">
                    <i class="ri-phone-line"></i> {telefono}
                  </button>
                  <button class="token-chip" data-token="{barrio}" title="Barrio">
                    <i class="ri-map-pin-2-line"></i> {barrio}
                  </button>
                  <button class="token-chip" data-token="{metodo_pago}" title="M√©todo de pago">
                    <i class="ri-bank-card-line"></i> {metodo_pago}
                  </button>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                  <label for="whatsappTemplateInput">
                    <i class="ri-message-3-line"></i> Plantilla del mensaje
                  </label>

                  <!-- Editor Toolbar -->
                  <div class="editor-toolbar">
                    <div class="toolbar-group">
                      <button type="button" class="toolbar-btn" data-format="bold" title="Negrita (*texto*)"><i
                          class="ri-bold"></i></button>
                      <button type="button" class="toolbar-btn" data-format="italic" title="Cursiva (_texto_)"><i
                          class="ri-italic"></i></button>
                      <button type="button" class="toolbar-btn" data-format="monospace"
                        title="Monoespacio (```texto```)"><i class="ri-code-view"></i></button>
                    </div>
                    <div class="toolbar-group">
                      <div class="emoji-dropdown">
                        <button type="button" class="toolbar-btn" id="toggleEmojiBtn" title="Insertar Emoji"><i
                            class="ri-emotion-line"></i></button>
                        <div id="emojiPicker" class="emoji-picker" style="display:none;">
                          <div class="emoji-tabs">
                            <button type="button" class="emoji-tab active" data-category="faces">üòä</button>
                            <button type="button" class="emoji-tab" data-category="food">üçî</button>
                            <button type="button" class="emoji-tab" data-category="objects">üí°</button>
                            <button type="button" class="emoji-tab" data-category="symbols">‚úÖ</button>
                          </div>
                          <div class="emoji-grid" id="emojiGrid">
                            <!-- Filled by JS -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <textarea id="whatsappTemplateInput" class="whatsapp-template-textarea" rows="10"
                    placeholder="Escribe tu mensaje aqu√≠ y haz clic en los tokens para insertarlos..."></textarea>
                  <small>Haz clic en los tokens de arriba para insertarlos en la plantilla</small>
                </div>

                <div class="template-actions">
                  <button id="previewTemplateBtn" class="btn-secondary">
                    <i class="ri-eye-line"></i> Vista previa
                  </button>
                  <button id="saveTemplateBtn" class="btn-primary">
                    <i class="ri-save-line"></i> Guardar plantilla
                  </button>
                </div>

                <div id="templatePreview" class="template-preview" style="display: none;">
                  <h4><i class="ri-file-text-line"></i> Vista previa con datos de ejemplo:</h4>
                  <div class="preview-box"></div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Section: Soporte -->
        <div id="section-support" class="dashboard-section" style="display: none;">
          <section class="card">
            <div class="card-header">
              <h2><i class="ri-customer-service-2-line"></i> Historial de Soporte</h2>
              <button id="createTicketBtn" class="btn-primary-small">
                <i class="ri-add-line"></i> Crear Solicitud
              </button>
            </div>
            <div class="card-content">
              <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1.5rem;">
                Aqu√≠ puedes ver el estado de tus solicitudes de ayuda.
              </p>
              <!-- Search Bar -->
              <div class="search-bar-container">
                <div class="search-bar">
                  <i class="ri-search-line"></i>
                  <input type="text" id="searchSupportInput" placeholder="Buscar por asunto..." />
                  <button id="clearSupportSearch" class="search-clear" style="display: none;">
                    <i class="ri-close-line"></i>
                  </button>
                </div>
              </div>
              <!-- Tabla de historial -->
              <div class="table-container">
                <table class="data-table" id="supportTicketsTable">
                  <thead>
                    <tr>
                      <th>Tickets</th>
                      <th>Asunto</th>
                      <th>Fecha</th>
                      <th>Estado</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="supportTicketsList">
                    <!-- Se llenar√° con JS -->
                  </tbody>
                </table>
                <p id="noTicketsMessage" class="empty-message" style="display: none;">No tienes solicitudes de
                  soporte.</p>
              </div>
            </div>
          </section>
        </div>

    </div>

    </main>
  </div>
  </div>

  <!-- Order Details Modal -->
  <div id="orderDetailsModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 650px; width: 95%;">
      <div class="modal-header">
        <h3>Detalle del Pedido</h3>
        <button class="modal-close" id="closeOrderDetailsBtn">&times;</button>
      </div>
      <div class="modal-body" id="orderDetailsContent" style="padding: 1.5rem; max-height: 70vh; overflow-y: auto;">
        <!-- Details injected by JS -->
      </div>
      <div class="modal-footer"
        style="padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 0.5rem;">
        <button class="btn-secondary" id="closeOrderDetailsFooterBtn">Cerrar</button>
        <button class="btn-primary" id="verifyOrderBtn" style="display: none;">
          <i class="ri-check-line"></i> Marcar como Verificado
        </button>
      </div>
    </div>
  </div>

  <!-- Color Customization Modal -->
  <div id="customizeColorModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>Personalizar Color del Cat√°logo</h3>
        <button class="modal-close" id="closeColorModalBtn">&times;</button>
      </div>
      <div class="modal-body" style="padding: 1.5rem;">
        <p style="color: #6b7280; font-size: 0.95rem; margin-bottom: 1.5rem;">
          Selecciona un color primario para tu cat√°logo. Este color se aplicar√° a botones, enlaces y elementos
          destacados.
        </p>

        <div id="colorGrid" class="color-grid"
          style="display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
          <!-- Predefined colors -->
          <button type="button" class="color-option active" data-color="#4ced17"
            style="background-color: #4ced17; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Verde (Por defecto)"></button>

          <button type="button" class="color-option" data-color="#3b82f6"
            style="background-color: #3b82f6; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Azul"></button>

          <button type="button" class="color-option" data-color="#6366f1"
            style="background-color: #6366f1; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Indigo"></button>

          <button type="button" class="color-option" data-color="#8b5cf6"
            style="background-color: #8b5cf6; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Violeta"></button>

          <button type="button" class="color-option" data-color="#ec4899"
            style="background-color: #ec4899; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Rosa"></button>

          <button type="button" class="color-option" data-color="#ef4444"
            style="background-color: #ef4444; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Rojo"></button>

          <button type="button" class="color-option" data-color="#f59e0b"
            style="background-color: #f59e0b; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Naranja"></button>

          <button type="button" class="color-option" data-color="#10b981"
            style="background-color: #10b981; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Esmeralda"></button>

          <button type="button" class="color-option" data-color="#0ea5e9"
            style="background-color: #0ea5e9; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Cielo"></button>

          <button type="button" class="color-option" data-color="#0f172a"
            style="background-color: #0f172a; width: 48px; height: 48px; border-radius: 50%; border: 2px solid #e5e7eb; cursor: pointer; transition: transform 0.2s;"
            title="Oscuro"></button>
        </div>

        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
          <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Color seleccionado:</span>
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
            <div id="previewColorCircle"
              style="width: 24px; height: 24px; border-radius: 50%; background: #4ced17; border: 1px solid #d1d5db;">
            </div>
            <span id="previewColorCode" style="font-family: monospace; color: #6b7280;">#4ced17</span>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelColorBtn">Cancelar</button>
          <button type="button" class="btn-primary" id="saveColorBtn">Guardar cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para ver detalle de solicitud de soporte (SOLO LECTURA) -->
  <div id="ticketDetailsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Detalle de la Solicitud</h3>
        <button class="modal-close" id="closeTicketDetailsModal">&times;</button>
      </div>
      <div class="modal-body" style="padding: 1.5rem;">

        <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
          <span id="detailTicketCode"
            style="font-family: monospace; font-weight: 600; color: var(--color-primary); font-size: 1.1rem;">-</span>
          <span id="detailTicketStatus" class="status-badge">-</span>
        </div>

        <div class="form-group">
          <label style="font-weight: 600;">Asunto</label>
          <p id="detailTicketTitle" style="padding: 0.5rem; background: #f9fafb; border-radius: 4px;">-</p>
        </div>

        <div class="form-group">
          <label style="font-weight: 600;">Fecha de creaci√≥n</label>
          <p id="detailTicketDate" style="color: #666;">-</p>
        </div>

        <div class="form-group">
          <label style="font-weight: 600;">Descripci√≥n</label>
          <div id="detailTicketDescription"
            style="padding: 0.75rem; background: #f9fafb; border-radius: 4px; min-height: 60px; white-space: pre-wrap;">
            -</div>
        </div>

        <div class="form-group" id="detailTicketImageContainer" style="display: none;">
          <label style="font-weight: 600;">Adjunto</label>
          <div style="margin-top: 0.5rem;">
            <img id="detailTicketImage" src="" alt="Adjunto"
              style="max-width: 100%; border-radius: 8px; border: 1px solid #e5e7eb;">
          </div>
        </div>

        <div class="form-group" id="detailTicketResponseContainer"
          style="display: none; margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1rem;">
          <label style="font-weight: 600; color: var(--color-primary);"><i class="ri-customer-service-2-line"></i>
            Respuesta de Soporte</label>
          <div id="detailTicketResponse"
            style="padding: 0.75rem; background: #f0f9ff; border-radius: 4px; color: #0c4a6e; margin-top: 0.5rem; white-space: pre-wrap;">
            -</div>
        </div>

        <div class="modal-actions" style="margin-top: 1.5rem;">
          <button type="button" class="btn-primary" id="closeTicketDetailsBtn">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para crear/editar negocio -->
  <div id="businessModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="businessModalTitle">Crear Negocio</h3>
        <button class="modal-close" id="closeBusinessModal">&times;</button>
      </div>
      <form id="businessForm" class="modal-form">
        <div class="form-group">
          <label for="businessNameInput">Nombre del negocio *</label>
          <input type="text" id="businessNameInput" required>
        </div>
        <div class="form-group">
          <label for="businessSlugInput">Slug (URL √∫nica) *</label>
          <input type="text" id="businessSlugInput" required>
          <small>Ejemplo: mi-negocio</small>
        </div>
        <div class="form-group">
          <label for="businessWhatsappInput">N√∫mero de WhatsApp *</label>
          <input type="tel" id="businessWhatsappInput" placeholder="3001234567" required>
          <small>Sin +57, ej: 3001234567. M√°x 10 d√≠gitos.</small>
          <div id="whatsappError" class="error-message"
            style="display: none; color: #ef4444; font-size: 0.85rem; margin-top: 0.25rem;">
            El n√∫mero debe empezar por 3 y tener m√°ximo 10 d√≠gitos.
          </div>
        </div>
        <div class="form-group">
          <label for="businessAddressInput">Direcci√≥n del negocio (opcional)</label>
          <input type="text" id="businessAddressInput" placeholder="Ej: Calle 123 # 45-67">
        </div>
        <div class="form-group">
          <label for="businessDeliveryPriceInput">Precio de Domicilio</label>
          <input type="number" id="businessDeliveryPriceInput" placeholder="0" min="0" step="0.01">
          <small>Valor cobrado por el servicio de domicilio (0 = gratis)</small>
        </div>
        <div class="form-group">
          <label for="businessDescriptionInput">Descripci√≥n</label>
          <textarea id="businessDescriptionInput" rows="3"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelBusinessBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveBusinessBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar producto -->
  <div id="productModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="productModalTitle">Nuevo Producto</h3>
        <button class="modal-close" id="closeProductModal">&times;</button>
      </div>
      <form id="productForm" class="modal-form">

        <!-- Image Upload Section -->
        <div class="form-group">
          <label>Imagen del producto</label>
          <div class="image-upload-container">
            <div class="image-preview" id="productImagePreview">
              <i class="ri-image-line"></i>
              <p>Click para seleccionar imagen</p>
              <small>JPG, PNG o WEBP (m√°x. 5MB)</small>
            </div>
            <input type="file" id="productImageInput" accept="image/jpeg,image/jpg,image/png,image/webp"
              style="display: none;">
            <div class="image-upload-actions" id="imageUploadActions" style="display: none;">
              <button type="button" class="btn-secondary-small" id="changeImageBtn">
                <i class="ri-image-edit-line"></i> Cambiar imagen
              </button>
              <button type="button" class="btn-secondary-small danger" id="removeImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="imageUploadProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="productNameInput">Nombre del producto *</label>
          <input type="text" id="productNameInput" required>
        </div>

        <div class="form-group">
          <label for="productPriceInput">Precio *</label>
          <input type="number" id="productPriceInput" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label for="productCategoryInput">Categor√≠a</label>
          <select id="productCategoryInput">
            <option value="">Sin categor√≠a</option>
          </select>
        </div>

        <div class="form-group">
          <label for="productDescriptionInput">Descripci√≥n</label>
          <textarea id="productDescriptionInput" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">Estado del
            producto</label>
          <div class="switch-container">
            <label class="switch">
              <input type="checkbox" id="productActiveInput" checked>
              <span class="slider"></span>
            </label>
            <span id="productActiveLabel" class="switch-label">Activo</span>
          </div>
        </div>

        <!-- Campo oculto para guardar la URL de la imagen -->
        <input type="hidden" id="productImageUrlHidden">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelProductBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveProductBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar categor√≠a -->
  <div id="categoryModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="categoryModalTitle">Nueva Categor√≠a</h3>
        <button class="modal-close" id="closeCategoryModal">&times;</button>
      </div>
      <form id="categoryForm" class="modal-form">
        <div class="form-group">
          <label for="categoryNameInput">Nombre de la categor√≠a *</label>
          <input type="text" id="categoryNameInput" required>
        </div>
        <div class="form-group">
          <label class="switch-container">
            <input type="checkbox" id="categoryActiveInput" checked>
            <span class="switch-slider"></span>
            <span class="switch-label">Categor√≠a activa</span>
          </label>
        </div>


        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelCategoryBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar men√∫ del d√≠a -->
  <div id="dailyMenuModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="dailyMenuModalTitle">Nuevo Men√∫ del D√≠a</h3>
        <button class="modal-close" id="closeDailyMenuModal">&times;</button>
      </div>
      <form id="dailyMenuForm" class="modal-form">

        <div class="form-group">
          <label for="dailyMenuNameInput">Nombre del Men√∫ *</label>
          <input type="text" id="dailyMenuNameInput" placeholder="Ej: Lunes, Especial Fin de Semana" required>
        </div>

        <div class="form-group">
          <label class="switch-container">
            <input type="checkbox" id="dailyMenuActiveInput">
            <span class="switch-slider"></span>
            <span class="switch-label">Activar men√∫ ahora (desactivar√° otros)</span>
          </label>
        </div>

        <div class="form-group">
          <label>Seleccionar Productos</label>
          <div class="search-bar"
            style="margin-bottom: 0.5rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="ri-search-line" style="color: #94a3b8;"></i>
            <input type="text" id="searchMenuProductsInput" placeholder="Buscar productos..."
              style="border: none; outline: none; width: 100%;">
          </div>
          <div id="menuProductsSelectionList" class="products-selection-list"
            style="max-height: 250px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 0.5rem;">
            <!-- JS will populate checkboxes here -->
            <p class="empty-message">Cargando productos...</p>
          </div>
          <small>Selecciona los productos que aparecer√°n en este men√∫. El orden de selecci√≥n ser√° el orden de
            visualizaci√≥n.</small>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelDailyMenuBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar Men√∫</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar producto -->
  <div id="productModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="productModalTitle">Nuevo Producto</h3>
        <button class="modal-close" id="closeProductModal">&times;</button>
      </div>
      <form id="productForm" class="modal-form">

        <!-- Image Upload Section -->
        <div class="form-group">
          <label>Imagen del producto</label>
          <div class="image-upload-container">
            <div class="image-preview" id="productImagePreview">
              <i class="ri-image-line"></i>
              <p>Click para seleccionar imagen</p>
              <small>JPG, PNG o WEBP (m√°x. 5MB)</small>
            </div>
            <input type="file" id="productImageInput" accept="image/jpeg,image/jpg,image/png,image/webp"
              style="display: none;">
            <div class="image-upload-actions" id="imageUploadActions" style="display: none;">
              <button type="button" class="btn-secondary-small" id="changeImageBtn">
                <i class="ri-image-edit-line"></i> Cambiar imagen
              </button>
              <button type="button" class="btn-secondary-small danger" id="removeImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="imageUploadProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="productNameInput">Nombre del producto *</label>
          <input type="text" id="productNameInput" required>
        </div>

        <div class="form-group">
          <label for="productPriceInput">Precio *</label>
          <input type="number" id="productPriceInput" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label for="productCategoryInput">Categor√≠a</label>
          <select id="productCategoryInput">
            <option value="">Sin categor√≠a</option>
          </select>
        </div>

        <div class="form-group">
          <label for="productDescriptionInput">Descripci√≥n</label>
          <textarea id="productDescriptionInput" rows="3"></textarea>
        </div>

        <!-- Campo oculto para guardar la URL de la imagen -->
        <input type="hidden" id="productImageUrlHidden">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelProductBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveProductBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para gestionar opciones del producto -->
  <div id="productOptionsModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="productOptionsModalTitle">Opciones del Producto</h3>
        <button class="modal-close" id="closeProductOptionsModal">&times;</button>
      </div>
      <div class="modal-body" style="padding: 1.5rem;">

        <div class="product-options-info"
          style="margin-bottom: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
          <h4 id="optionsProductName" style="font-size: 1.1rem; margin-bottom: 0.5rem;"></h4>
          <p style="color: #666; font-size: 0.9rem;">Configura comentarios r√°pidos y acompa√±antes para este producto</p>
        </div>

        <!-- Quick Comments Section -->
        <div class="options-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 600;">Comentarios R√°pidos</h4>
            <button class="btn-primary-small" id="addQuickCommentBtn">+ Agregar</button>
          </div>
          <div id="quickCommentsListDashboard" class="options-list">
            <p class="empty-message" style="padding: 1rem; text-align: center; color: #9ca3af; font-size: 0.9rem;">
              No hay comentarios r√°pidos
            </p>
          </div>
        </div>

        <!-- Sides Section -->
        <div class="options-section" style="margin-top: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 600;">Acompa√±antes</h4>
            <button class="btn-primary-small" id="addSideBtn">+ Agregar</button>
          </div>
          <div id="sidesListDashboard" class="options-list">
            <p class="empty-message" style="padding: 1rem; text-align: center; color: #9ca3af; font-size: 0.9rem;">
              No hay acompa√±antes
            </p>
          </div>
        </div>

        <!-- Sizes Section -->
        <div class="options-section" style="margin-top: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 600;">Tama√±os</h4>
            <button class="btn-primary-small" id="addSizeBtn">+ Agregar</button>
          </div>
          <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
            Define diferentes tama√±os con precios espec√≠ficos. Si el producto tiene tama√±os, se mostrar√° el rango de
            precios en el cat√°logo.
          </p>
          <div id="sizesListDashboard" class="options-list">
            <p class="empty-message" style="padding: 1rem; text-align: center; color: #9ca3af; font-size: 0.9rem;">
              No hay tama√±os configurados
            </p>
          </div>
        </div>

      </div>
      <div style="padding: 1.5rem; border-top: 1px solid var(--color-border); display: flex; justify-content: center;">
        <button class="btn-primary" id="closeProductOptionsBtn"
          style="width: 100%; text-align: center; justify-content: center;">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal para crear/editar opci√≥n -->
  <div id="optionModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="optionModalTitle">Nueva Opci√≥n</h3>
        <button class="modal-close" id="closeOptionModal">&times;</button>
      </div>
      <form id="optionForm" class="modal-form">
        <div class="form-group">
          <label for="optionNameInput">Nombre *</label>
          <input type="text" id="optionNameInput" required>
        </div>
        <div class="form-group" id="optionPriceGroup">
          <label for="optionPriceInput">Precio adicional</label>
          <input type="number" id="optionPriceInput" step="0.01" min="0" value="0">
          <small>Dejar en 0 si no tiene costo adicional</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelOptionBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar tama√±o -->
  <div id="sizeModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="sizeModalTitle">Nuevo Tama√±o</h3>
        <button class="modal-close" id="closeSizeModal">&times;</button>
      </div>
      <form id="sizeForm" class="modal-form">
        <div class="form-group">
          <label for="sizeNameInput">Nombre del tama√±o *</label>
          <input type="text" id="sizeNameInput" placeholder="Ej: Personal, Small, Medium, Large" required>
        </div>
        <div class="form-group">
          <label for="sizePriceInput">Precio *</label>
          <input type="number" id="sizePriceInput" step="0.01" min="0" placeholder="0.00" required>
          <small>Precio espec√≠fico para este tama√±o</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelSizeBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar m√©todo de pago -->
  <div id="paymentMethodModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="paymentMethodModalTitle">Nuevo M√©todo de Pago</h3>
        <button class="modal-close" id="closePaymentMethodModal">&times;</button>
      </div>
      <form id="paymentMethodForm" class="modal-form">
        <div class="form-group">
          <label for="paymentMethodNameInput">Nombre del m√©todo de pago *</label>
          <input type="text" id="paymentMethodNameInput" placeholder="Ej: Efectivo, Tarjeta, Transferencia" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelPaymentMethodBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="savePaymentMethodBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>



  <!-- Export Orders Modal -->
  <div id="exportOrdersModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2><i class="ri-file-excel-2-line"></i> Exportar Pedidos</h2>
        <button class="modal-close" id="closeExportModalBtn">&times;</button>
      </div>
      <form id="exportOrdersForm" class="modal-form">
        <p class="modal-description" style="color: #4b5563; margin-bottom: 0.5rem;">
          Selecciona el rango de fechas y el estado de los pedidos que deseas exportar a Excel.
        </p>
        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
          <div class="form-group">
            <label for="exportStartDate">Fecha Inicial</label>
            <input type="date" id="exportStartDate" required class="form-input">
          </div>
          <div class="form-group">
            <label for="exportEndDate">Fecha Final</label>
            <input type="date" id="exportEndDate" required class="form-input">
          </div>
        </div>
        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label for="exportStatus">Estado</label>
          <select id="exportStatus" class="form-select">
            <option value="all">Todos los estados</option>
            <option value="pending">Pendientes</option>
            <option value="verified">Verificados</option>
            <option value="dispatched">Despachados</option>
            <option value="completed">Completados</option>
            <option value="cancelled">Cancelados</option>
          </select>
        </div>
        <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: flex-end;">
          <button type="button" class="btn-secondary" id="cancelExportBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="confirmExportBtn">
            <i class="ri-download-2-line"></i> Descargar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delivery Person Modal (Create/Edit) -->
  <div id="deliveryPersonModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="deliveryPersonModalTitle">Nuevo Domiciliario</h3>
        <button class="modal-close" id="closeDeliveryPersonModal">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <form id="deliveryPersonForm" class="modal-form">
        <input type="hidden" id="deliveryPersonId">

        <!-- Active Status (Moved to Top) -->
        <div class="form-group-inline">
          <label for="deliveryPersonActive" style="margin: 0;">Estado Activo</label>
          <label class="switch">
            <input type="checkbox" id="deliveryPersonActive" checked>
            <span class="slider round"></span>
          </label>
        </div>

        <div class="form-group" id="codeGroup" style="display: none;">
          <label>C√≥digo √önico</label>
          <input type="text" id="deliveryPersonCode" disabled class="delivery-code">
        </div>

        <div class="form-group">
          <label for="deliveryPersonName">Nombre Completo *</label>
          <input type="text" id="deliveryPersonName" required minlength="3" placeholder="Ej: Juan P√©rez">
        </div>

        <div class="form-group">
          <label for="deliveryPersonVehicle">Tipo de Veh√≠culo *</label>
          <select id="deliveryPersonVehicle" required>
            <option value="moto">Moto</option>
            <option value="bicicleta">Bicicleta</option>
            <option value="moto_electrica">Moto El√©ctrica</option>
            <option value="ciclomotor">Ciclomotor</option>
            <option value="carro">Carro</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelDeliveryPersonBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveDeliveryPersonBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delivery Detail Modal -->
  <div id="deliveryDetailModal" class="modal" style="display: none;">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>Detalles del Domiciliario</h3>
        <button class="modal-close" id="closeDeliveryDetailModal">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="delivery-detail-body">
        <div class="delivery-detail-header">
          <div class="delivery-avatar-large">
            <i class="ri-user-smile-line"></i>
          </div>
          <div>
            <h3 id="detailName" style="margin: 0; font-size: 1.5rem;">-</h3>
            <span id="detailCode" class="delivery-code">-</span>
            <span id="detailVehicle" class="badge-vehicle moto">-</span>
            <span id="detailStatus" class="badge-status active">Activo</span>
          </div>
        </div>

        <div class="delivery-stats-grid">
          <div class="stat-box">
            <span class="value" id="detailTotalDeliveries">0</span>
            <span class="label">Total Domicilios</span>
          </div>
          <div class="stat-box">
            <span class="value" id="detailJoinedDate">-</span>
            <span class="label">Fecha Registro</span>
          </div>
        </div>

        <h3>√öltimos Pedidos Asignados</h3>
        <div class="table-container recent-deliveries-list">
          <table class="data-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Pedido</th>
                <th>Cliente</th>
                <th>Total</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="detailRecentHistory">
              <!-- JS Generated -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Assign Order Modal -->
  <div id="assignOrderModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Despachar Pedido</h3>
        <button class="modal-close" id="closeAssignOrderModal">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="assign-body">
        <p>Selecciona un domiciliario para el pedido <strong id="assignOrderNumber">#</strong></p>

        <div class="search-delivery-input" style="margin-bottom: 1rem;">
          <i class="ri-search-line"></i>
          <input type="text" id="searchAssignInput" placeholder="Filtrar domiciliario...">
        </div>

        <div class="assignment-list" id="assignmentList">
          <!-- Options generated by JS -->
          <div class="assignment-option" data-id="null">
            <div class="assignment-info">
              <h4>Sin asignar</h4>
              <p>Despachar sin domiciliario espec√≠fico</p>
            </div>
            <i class="ri-user-unfollow-line"></i>
          </div>
          <!-- More items -->
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelAssignBtn">Cancelar</button>
          <button type="button" class="btn-primary" id="confirmAssignBtn">Confirmar Despacho</button>
        </div>
      </div>
    </div>
  </div>


  <script type="module" src="/src/pages/dashboard/dashboard.js"></script>

  <!-- Modal para crear/editar promoci√≥n -->
  <div id="promotionModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3 id="promotionModalTitle">Nueva Promoci√≥n</h3>
        <button class="modal-close" id="closePromotionModal">&times;</button>
      </div>
      <form id="promotionForm" class="modal-form">

        <!-- Image Upload Section (16:9) -->
        <div class="form-group">
          <label>Banner de la promoci√≥n (Formato 16:9)</label>
          <div class="image-upload-container wide">
            <div class="image-preview wide" id="promotionImagePreview">
              <i class="ri-image-add-line"></i>
              <p>Click para seleccionar imagen</p>
              <small>Recomendado: 1280x720px (JPG, PNG, WEBP)</small>
            </div>
            <input type="file" id="promotionImageInput" accept="image/jpeg,image/jpg,image/png,image/webp"
              style="display: none;">
            <div class="image-upload-actions" id="promotionImageActions" style="display: none;">
              <button type="button" class="btn-secondary-small" id="changePromotionImageBtn">
                <i class="ri-image-edit-line"></i> Cambiar
              </button>
              <button type="button" class="btn-secondary-small danger" id="removePromotionImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="promotionImageProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="promotionTitleInput">T√≠tulo *</label>
            <input type="text" id="promotionTitleInput" placeholder="Ej: Combo Familiar" required>
          </div>
          <div class="form-group">
            <label for="promotionPriceInput">Precio *</label>
            <input type="number" id="promotionPriceInput" step="0.01" min="0" required>
          </div>
        </div>

        <div class="form-group">
          <label for="promotionDescriptionInput">Descripci√≥n</label>
          <textarea id="promotionDescriptionInput" rows="2"
            placeholder="Describe lo que incluye la promoci√≥n..."></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="promotionStartDate">Fecha inicio (opcional)</label>
            <input type="datetime-local" id="promotionStartDate" required>
          </div>
          <div class="form-group">
            <label for="promotionEndDate">Fecha fin (opcional)</label>
            <input type="datetime-local" id="promotionEndDate" required>
          </div>
        </div>

        <div class="form-group">
          <label class="switch-container">
            <input type="checkbox" id="promotionActiveInput" checked>
            <span class="switch-slider"></span>
            <span class="switch-label">Promoci√≥n activa</span>
          </label>
        </div>

        <!-- Campo oculto para la imagen -->
        <input type="hidden" id="promotionImageUrlHidden">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelPromotionBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="savePromotionBtn">Guardar Promoci√≥n</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Modal para crear solicitud de soporte -->
  <div id="supportModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Nueva Solicitud de Soporte</h3>
        <button class="modal-close" id="closeSupportModal">&times;</button>
      </div>
      <form id="supportForm" class="modal-form">

        <div class="form-group">
          <label for="ticketTitle">T√≠tulo de la solicitud *</label>
          <input type="text" id="ticketTitle" required placeholder="Ej: Problema con un producto">
        </div>

        <div class="form-group">
          <label for="ticketDescription">Descripci√≥n del problema *</label>
          <textarea id="ticketDescription" rows="4" required
            placeholder="Describe detalladamente el problema..."></textarea>
        </div>

        <div class="form-group">
          <label>Imagen del problema</label>
          <div class="image-upload-container">
            <div class="image-preview" id="ticketImagePreview">
              <i class="ri-image-line"></i>
              <p>Click para subir imagen</p>
            </div>
            <input type="file" id="ticketImageInput" accept="image/*" style="display: none;">
            <input type="hidden" id="ticketImageUrl">
            <div class="image-upload-actions" id="ticketImageActions" style="display: none;">
              <button type="button" class="btn-secondary-small danger" id="removeTicketImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="ticketImageProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="ticketContactName">Nombre de contacto</label>
            <input type="text" id="ticketContactName" placeholder="Tu nombre">
          </div>
          <div class="form-group">
            <label for="ticketContactPhone">Tel√©fono *</label>
            <input type="tel" id="ticketContactPhone" required readonly
              style="background-color: #f3f4f6; cursor: not-allowed;">
            <small>Tomado de tu negocio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="ticketContactEmail">Correo electr√≥nico *</label>
          <input type="email" id="ticketContactEmail" required readonly
            style="background-color: #f3f4f6; cursor: not-allowed;">
          <small>Tomado de tu cuenta</small>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelSupportBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="submitTicketBtn">Enviar Solicitud</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para gestionar descuento de producto -->
  <div id="discountModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Gestionar Descuento - <span id="discountProductName"></span></h3>
        <button class="modal-close" id="closeDiscountModal">&times;</button>
      </div>
      <form id="discountForm" class="modal-form">

        <!-- Toggle Activo/Inactivo -->
        <div class="form-group">
          <label class="switch-container">
            <input type="checkbox" id="discountActiveInput">
            <span class="switch-slider"></span>
            <span class="switch-label">Descuento activo</span>
          </label>
        </div>

        <!-- Porcentaje de descuento -->
        <div class="form-group">
          <label for="discountPercentage">Porcentaje de descuento (%) *</label>
          <input type="number" id="discountPercentage" min="1" max="99" step="1" placeholder="20" required>
          <small>Ingresa un valor entre 1 y 99</small>
        </div>

        <!-- Precio calculado (solo lectura) -->
        <div class="form-group">
          <label for="discountedPrice">Precio con descuento</label>
          <input type="text" id="discountedPrice" readonly
            style="background-color: #f3f4f6; cursor: not-allowed; font-weight: 600; color: var(--color-primary);">
          <small>Precio original: $<span id="originalPrice">0</span></small>
        </div>

        <!-- Fechas inicio y fin -->
        <div class="form-row">
          <div class="form-group">
            <label for="discountStartDate">Fecha inicio *</label>
            <input type="date" id="discountStartDate" required>
          </div>
          <div class="form-group">
            <label for="discountEndDate">Fecha fin *</label>
            <input type="date" id="discountEndDate" required>
          </div>
        </div>

        <!-- Campo oculto para product_id -->
        <input type="hidden" id="discountProductId">
        <input type="hidden" id="discountOriginalPrice">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelDiscountBtn">Cancelar</button>
          <button type="button" class="btn-danger" id="deleteDiscountBtn" style="display: none;">
            <i class="ri-delete-bin-line"></i> Eliminar descuento
          </button>
          <button type="submit" class="btn-primary" id="saveDiscountBtn">Guardar descuento</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Modal Upgrade Plan -->
  <div id="upgradePlanModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px; text-align: center;">
      <div class="modal-header" style="justify-content: center; border: none;">
        <button class="modal-close" id="closeUpgradeModal"
          style="position: absolute; right: 1rem; top: 1rem;">&times;</button>
      </div>
      <div style="padding: 0 1rem 2rem 1rem;">
        <div
          style="background: #e0e7ff; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem auto;">
          <i class="ri-rocket-fill" style="font-size: 3rem; color: #4338ca;"></i>
        </div>
        <h2 style="margin-bottom: 0.5rem; font-size: 1.75rem;">¬°Mejora tu Plan a PRO!</h2>
        <p style="color: #64748b; margin-bottom: 2rem;">
          Has alcanzado el l√≠mite de tu plan actual o quieres acceder a funcionalidades ilimitadas.
          P√°sate a PRO y lleva tu negocio al siguiente nivel.
        </p>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; text-align: left;">
          <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.75rem;">
            <li style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="ri-checkbox-circle-fill" style="color: #10b981;"></i> Productos Ilimitados
            </li>
            <li style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="ri-checkbox-circle-fill" style="color: #10b981;"></i> Pedidos ilimitados
            </li>
            <li style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="ri-checkbox-circle-fill" style="color: #10b981;"></i> Soporte Prioritario
            </li>
          </ul>
        </div>

        <button id="contactSupportUpgradeBtn" class="btn-primary"
          style="width: 100%; justify-content: center; padding: 1rem;">
          <i class="ri-whatsapp-line"></i> Contactar para Upgrade
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Plan Bloqueado (Vencido) -->
  <div id="blockedPlanModal" class="modal" style="display: none; background: rgba(0,0,0,0.9); z-index: 9999;">
    <div class="modal-content" style="max-width: 500px; text-align: center;">
      <!-- No close button - Blocking modal -->
      <div style="padding: 2rem 1rem;">
        <div
          style="background: #fee2e2; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem auto;">
          <i class="ri-lock-2-fill" style="font-size: 3rem; color: #dc2626;"></i>
        </div>
        <h2 style="margin-bottom: 0.5rem; font-size: 1.75rem; color: #dc2626;">Tu Plan ha Vencido</h2>
        <p style="color: #64748b; margin-bottom: 2rem;">
          Tu periodo de suscripci√≥n ha finalizado. Tu cat√°logo est√° actualmente en modo mantenimiento y no puedes
          recibir nuevos pedidos.
        </p>

        <div
          style="background: #fff1f2; border: 1px solid #fecaca; padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
          <p style="color: #991b1b; font-size: 0.9rem;">
            <strong>Estado:</strong> Inactivo<br>
            Renueva tu plan para reactivar tu negocio inmediatamente.
          </p>
        </div>

        <button id="contactSupportRenewBtn" class="btn-primary"
          style="width: 100%; justify-content: center; padding: 1rem;">
          <i class="ri-whatsapp-line"></i> Contactar para Renovar
        </button>

        <button id="logoutBlockedBtn" class="btn-secondary"
          style="width: 100%; justify-content: center; margin-top: 1rem;">
          Cerrar Sesi√≥n
        </button>
      </div>
    </div>
  </div>

  <!-- Reminder Modal -->
  <div id="whatsappReminderModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
      <div class="modal-header"
        style="flex-direction: column; align-items: center; border-bottom: none; padding-bottom: 0;">
        <div
          style="display: flex; align-items: center; justify-content: center; width: 60px; height: 60px; background-color: #eff6ff; border-radius: 50%; margin-bottom: 1rem;">
          <i class="ri-information-line" style="font-size: 32px; color: #3b82f6;"></i>
        </div>
        <h3 style="color: var(--color-primary); font-size: 1.5rem; margin: 0;">¬°Recordatorio importante!</h3>
      </div>
      <div class="modal-body" style="padding: 1rem 1.5rem;">
        <p style="color: #4b5563; font-size: 1.1rem; line-height: 1.5;">
          Recuerda verificar los valores de los productos y el total en el mensaje de Whatsapp que te env√≠an tus
          clientes
        </p>
        <div style="margin-top: 1.5rem;">
          <button id="closeReminderModalBtn" class="btn-primary" style="width: 100%; justify-content: center;">
            Entendido
          </button>
        </div>
      </div>
    </div>
  </div>

</body>

</html>

<!-- comentario solo para comitearr -->