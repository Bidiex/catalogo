<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Cat치logo SaaS</title>
  <link rel="stylesheet" href="/src/styles/global.css">
  <link rel="stylesheet" href="./dashboard.css">
</head>

<body>
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1><i class="ri-store-2-line"></i> Mi Cat치logo</h1>
      <div class="header-actions">
        <span id="userEmail" class="user-email"></span>
        <button id="logoutBtn" class="btn-logout">
          <i class="ri-logout-box-line"></i>
          <span>Cerrar sesi칩n</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">

    <!-- Loading state -->
    <div id="loadingState" class="loading-state">
      <p>Cargando...</p>
    </div>

    <!-- No business state (primer uso) - NUEVO ONBOARDING -->
    <div id="noBusinessState" class="no-business-state" style="display: none;">
      <div class="onboarding-wizard">

        <!-- Progress indicator -->
        <div class="wizard-progress">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <span>Negocio</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <span>Categor칤as</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <span>Producto</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="4">
            <div class="step-number">4</div>
            <span>Listo</span>
          </div>
        </div>

        <!-- Step 1: Business -->
        <div class="wizard-step" id="wizard-step-1">
          <div class="wizard-header">
            <i class="ri-store-2-line wizard-icon"></i>
            <h2>Informaci칩n de tu negocio</h2>
            <p>Completa los datos b치sicos para comenzar</p>
          </div>

          <form class="wizard-form" id="wizardBusinessForm">
            <div class="form-group">
              <label for="wiz-business-name">Nombre del negocio *</label>
              <input type="text" id="wiz-business-name" placeholder="Ej: Burger Master" required>
            </div>

            <div class="form-group">
              <label for="wiz-whatsapp">WhatsApp *</label>
              <input type="tel" id="wiz-whatsapp" placeholder="+573001234567" required>
              <small>Incluye c칩digo de pa칤s (+57 para Colombia)</small>
            </div>

            <div class="form-group">
              <label for="wiz-description">Descripci칩n</label>
              <textarea id="wiz-description" rows="2" placeholder="Describe tu negocio..."></textarea>
            </div>

            <button type="submit" class="btn-primary btn-block">
              Continuar <i class="ri-arrow-right-line"></i>
            </button>
          </form>
        </div>

        <!-- Step 2: Categories -->
        <div class="wizard-step" id="wizard-step-2" style="display: none;">
          <div class="wizard-header">
            <i class="ri-folder-line wizard-icon"></i>
            <h2>Agrega categor칤as</h2>
            <p>Organiza tus productos (opcional)</p>
          </div>

          <div class="wizard-content">
            <div class="category-input-group">
              <input type="text" id="wiz-category-input" placeholder="Ej: Hamburguesas, Bebidas...">
              <button type="button" id="wiz-add-category" class="btn-primary">
                <i class="ri-add-line"></i>
              </button>
            </div>

            <div id="wiz-categories-display" class="categories-display">
              <!-- Se llenar치n con JS -->
            </div>

            <div class="wizard-actions">
              <button type="button" id="wiz-skip-categories" class="btn-secondary">
                Omitir
              </button>
              <button type="button" id="wiz-continue-categories" class="btn-primary">
                Continuar <i class="ri-arrow-right-line"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 3: Product -->
        <div class="wizard-step" id="wizard-step-3" style="display: none;">
          <div class="wizard-header">
            <i class="ri-shopping-bag-line wizard-icon"></i>
            <h2>Primer producto</h2>
            <p>Agrega tu primer producto (opcional)</p>
          </div>

          <div class="wizard-content">
            <form class="wizard-form" id="wizardProductForm">
              <div class="form-group">
                <label for="wiz-product-name">Nombre del producto</label>
                <input type="text" id="wiz-product-name" placeholder="Ej: Hamburguesa Cl치sica">
              </div>

              <div class="form-group">
                <label for="wiz-product-price">Precio</label>
                <input type="number" id="wiz-product-price" step="0.01" min="0" placeholder="0.00">
              </div>

              <div class="form-group" id="wiz-product-category-group" style="display: none;">
                <label for="wiz-product-category">Categor칤a</label>
                <select id="wiz-product-category">
                  <option value="">Sin categor칤a</option>
                </select>
              </div>

              <div class="form-group">
                <label for="wiz-product-description">Descripci칩n</label>
                <textarea id="wiz-product-description" rows="2" placeholder="Describe el producto..."></textarea>
              </div>
            </form>

            <div class="wizard-actions">
              <button type="button" id="wiz-skip-product" class="btn-secondary">
                Omitir
              </button>
              <button type="button" id="wiz-continue-product" class="btn-primary">
                Finalizar <i class="ri-check-line"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 4: Success -->
        <div class="wizard-step" id="wizard-step-4" style="display: none;">
          <div class="wizard-header success">
            <i class="ri-checkbox-circle-line wizard-icon"></i>
            <h2>춰Todo listo! 游꿀</h2>
            <p>Tu negocio est치 configurado</p>
          </div>

          <div class="wizard-content">
            <div class="success-summary">
              <div class="summary-item">
                <i class="ri-store-2-line"></i>
                <div>
                  <strong>Negocio creado</strong>
                  <p id="summary-business-name">-</p>
                </div>
              </div>
              <div class="summary-item" id="summary-categories-box" style="display: none;">
                <i class="ri-folder-line"></i>
                <div>
                  <strong>Categor칤as</strong>
                  <p id="summary-categories-text">-</p>
                </div>
              </div>
              <div class="summary-item" id="summary-product-box" style="display: none;">
                <i class="ri-shopping-bag-line"></i>
                <div>
                  <strong>Producto</strong>
                  <p id="summary-product-text">-</p>
                </div>
              </div>
            </div>

            <button type="button" id="wiz-finish" class="btn-primary btn-block">
              Ir al Dashboard <i class="ri-arrow-right-line"></i>
            </button>
          </div>
        </div>

      </div>
    </div>

    <!-- Business exists state -->
    <div id="businessExistsState" class="business-state" style="display: none;">

      <!-- Business info card -->
      <section class="card">
        <div class="card-header">
          <h2><i class="ri-building-line"></i> Mi Negocio</h2>
          <button id="editBusinessBtn" class="btn-secondary-small">
            <i class="ri-edit-line"></i> Editar
          </button>
        </div>
        <div class="card-content">
          <div class="business-info">
            <div class="info-row">
              <span class="label"><i class="ri-store-line"></i> Nombre:</span>
              <span id="businessName" class="value">-</span>
            </div>
            <div class="info-row">
              <span class="label"><i class="ri-whatsapp-line"></i> WhatsApp:</span>
              <span id="businessWhatsapp" class="value">-</span>
            </div>
            <div class="info-row">
              <span class="label"><i class="ri-link"></i> Enlace del cat치logo:</span>
              <div class="catalog-link">
                <a id="catalogLink" href="#" target="_blank" class="link">-</a>
                <button id="copyLinkBtn" class="btn-copy">
                  <i class="ri-file-copy-line"></i> Copiar
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Categories section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="ri-folder-line"></i> Categor칤as</h2>
          <button id="addCategoryBtn" class="btn-primary-small">
            <i class="ri-add-line"></i> Agregar
          </button>
        </div>
        <div class="card-content">
          <div id="categoriesList" class="categories-list">
            <p class="empty-message">No hay categor칤as a칰n</p>
          </div>
        </div>
      </section>

      <!-- Products section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="ri-shopping-bag-line"></i> Productos</h2>
          <button id="addProductBtn" class="btn-primary-small">
            <i class="ri-add-line"></i> Agregar
          </button>
        </div>
        <div class="card-content">
          <div id="productsList" class="products-list">
            <p class="empty-message">No hay productos a칰n</p>
          </div>
        </div>
      </section>

      <!-- WhatsApp Template Section -->
      <section class="card">
        <div class="card-header">
          <h2><i class="ri-whatsapp-line"></i> Mensaje de WhatsApp</h2>
        </div>
        <div class="card-content">
          <div class="whatsapp-template-editor">
            <div class="template-help">
              <p><strong>Personaliza el mensaje que se enviar치 por WhatsApp</strong></p>
              <p class="help-text">Usa los tokens para insertar informaci칩n din치mica del pedido:</p>
            </div>

            <div class="tokens-grid">
              <button class="token-chip" data-token="{productos}" title="Lista de productos del pedido">
                <i class="ri-shopping-basket-line"></i> {productos}
              </button>
              <button class="token-chip" data-token="{total}" title="Total del pedido">
                <i class="ri-money-dollar-circle-line"></i> {total}
              </button>
              <button class="token-chip" data-token="{nombre}" title="Nombre del cliente">
                <i class="ri-user-line"></i> {nombre}
              </button>
              <button class="token-chip" data-token="{direccion}" title="Direcci칩n de entrega">
                <i class="ri-map-pin-line"></i> {direccion}
              </button>
              <button class="token-chip" data-token="{telefono}" title="Tel칠fono del cliente">
                <i class="ri-phone-line"></i> {telefono}
              </button>
              <button class="token-chip" data-token="{metodo_pago}" title="M칠todo de pago">
                <i class="ri-bank-card-line"></i> {metodo_pago}
              </button>
            </div>

            <div class="form-group" style="margin-top: 1.5rem;">
              <label for="whatsappTemplateInput">
                <i class="ri-message-3-line"></i> Plantilla del mensaje
              </label>
              <textarea id="whatsappTemplateInput" class="whatsapp-template-textarea" rows="10"
                placeholder="Escribe tu mensaje aqu칤 y haz clic en los tokens para insertarlos..."></textarea>
              <small>Haz clic en los tokens de arriba para insertarlos en la plantilla</small>
            </div>

            <div class="template-actions">
              <button id="previewTemplateBtn" class="btn-secondary">
                <i class="ri-eye-line"></i> Vista previa
              </button>
              <button id="saveTemplateBtn" class="btn-primary">
                <i class="ri-save-line"></i> Guardar plantilla
              </button>
            </div>

            <div id="templatePreview" class="template-preview" style="display: none;">
              <h4><i class="ri-file-text-line"></i> Vista previa con datos de ejemplo:</h4>
              <div class="preview-box"></div>
            </div>
          </div>
        </div>
      </section>

    </div>

  </main>

  <!-- Modal para crear/editar negocio -->
  <div id="businessModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="businessModalTitle">Crear Negocio</h3>
        <button class="modal-close" id="closeBusinessModal">&times;</button>
      </div>
      <form id="businessForm" class="modal-form">
        <div class="form-group">
          <label for="businessNameInput">Nombre del negocio *</label>
          <input type="text" id="businessNameInput" required>
        </div>
        <div class="form-group">
          <label for="businessSlugInput">Slug (URL 칰nica) *</label>
          <input type="text" id="businessSlugInput" required>
          <small>Ejemplo: mi-negocio</small>
        </div>
        <div class="form-group">
          <label for="businessWhatsappInput">N칰mero de WhatsApp *</label>
          <input type="tel" id="businessWhatsappInput" placeholder="+573001234567" required>
          <small>Formato: +57 seguido del n칰mero</small>
        </div>
        <div class="form-group">
          <label for="businessDescriptionInput">Descripci칩n</label>
          <textarea id="businessDescriptionInput" rows="3"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelBusinessBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveBusinessBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>


  <!-- Modal para crear/editar producto -->
  <div id="productModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="productModalTitle">Nuevo Producto</h3>
        <button class="modal-close" id="closeProductModal">&times;</button>
      </div>
      <form id="productForm" class="modal-form">

        <!-- Image Upload Section -->
        <div class="form-group">
          <label>Imagen del producto</label>
          <div class="image-upload-container">
            <div class="image-preview" id="productImagePreview">
              <i class="ri-image-line"></i>
              <p>Click para seleccionar imagen</p>
              <small>JPG, PNG o WEBP (m치x. 5MB)</small>
            </div>
            <input type="file" id="productImageInput" accept="image/jpeg,image/jpg,image/png,image/webp"
              style="display: none;">
            <div class="image-upload-actions" id="imageUploadActions" style="display: none;">
              <button type="button" class="btn-secondary-small" id="changeImageBtn">
                <i class="ri-image-edit-line"></i> Cambiar imagen
              </button>
              <button type="button" class="btn-secondary-small danger" id="removeImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="imageUploadProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="productNameInput">Nombre del producto *</label>
          <input type="text" id="productNameInput" required>
        </div>

        <div class="form-group">
          <label for="productPriceInput">Precio *</label>
          <input type="number" id="productPriceInput" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label for="productCategoryInput">Categor칤a</label>
          <select id="productCategoryInput">
            <option value="">Sin categor칤a</option>
          </select>
        </div>

        <div class="form-group">
          <label for="productDescriptionInput">Descripci칩n</label>
          <textarea id="productDescriptionInput" rows="3"></textarea>
        </div>

        <!-- Campo oculto para guardar la URL de la imagen -->
        <input type="hidden" id="productImageUrlHidden">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelProductBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveProductBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar categor칤a -->
  <div id="categoryModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="categoryModalTitle">Nueva Categor칤a</h3>
        <button class="modal-close" id="closeCategoryModal">&times;</button>
      </div>
      <form id="categoryForm" class="modal-form">
        <div class="form-group">
          <label for="categoryNameInput">Nombre de la categor칤a *</label>
          <input type="text" id="categoryNameInput" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelCategoryBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar producto -->
  <div id="productModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="productModalTitle">Nuevo Producto</h3>
        <button class="modal-close" id="closeProductModal">&times;</button>
      </div>
      <form id="productForm" class="modal-form">

        <!-- Image Upload Section -->
        <div class="form-group">
          <label>Imagen del producto</label>
          <div class="image-upload-container">
            <div class="image-preview" id="productImagePreview">
              <i class="ri-image-line"></i>
              <p>Click para seleccionar imagen</p>
              <small>JPG, PNG o WEBP (m치x. 5MB)</small>
            </div>
            <input type="file" id="productImageInput" accept="image/jpeg,image/jpg,image/png,image/webp"
              style="display: none;">
            <div class="image-upload-actions" id="imageUploadActions" style="display: none;">
              <button type="button" class="btn-secondary-small" id="changeImageBtn">
                <i class="ri-image-edit-line"></i> Cambiar imagen
              </button>
              <button type="button" class="btn-secondary-small danger" id="removeImageBtn">
                <i class="ri-delete-bin-line"></i> Eliminar
              </button>
            </div>
            <div class="image-upload-progress" id="imageUploadProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p>Subiendo imagen...</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="productNameInput">Nombre del producto *</label>
          <input type="text" id="productNameInput" required>
        </div>

        <div class="form-group">
          <label for="productPriceInput">Precio *</label>
          <input type="number" id="productPriceInput" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label for="productCategoryInput">Categor칤a</label>
          <select id="productCategoryInput">
            <option value="">Sin categor칤a</option>
          </select>
        </div>

        <div class="form-group">
          <label for="productDescriptionInput">Descripci칩n</label>
          <textarea id="productDescriptionInput" rows="3"></textarea>
        </div>

        <!-- Campo oculto para guardar la URL de la imagen -->
        <input type="hidden" id="productImageUrlHidden">

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelProductBtn">Cancelar</button>
          <button type="submit" class="btn-primary" id="saveProductBtn">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para gestionar opciones del producto -->
  <div id="productOptionsModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="productOptionsModalTitle">Opciones del Producto</h3>
        <button class="modal-close" id="closeProductOptionsModal">&times;</button>
      </div>
      <div class="modal-body" style="padding: 1.5rem;">

        <div class="product-options-info"
          style="margin-bottom: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
          <h4 id="optionsProductName" style="font-size: 1.1rem; margin-bottom: 0.5rem;"></h4>
          <p style="color: #666; font-size: 0.9rem;">Configura comentarios r치pidos y acompa침antes para este producto</p>
        </div>

        <!-- Quick Comments Section -->
        <div class="options-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 600;">Comentarios R치pidos</h4>
            <button class="btn-primary-small" id="addQuickCommentBtn">+ Agregar</button>
          </div>
          <div id="quickCommentsListDashboard" class="options-list">
            <p class="empty-message" style="padding: 1rem; text-align: center; color: #9ca3af; font-size: 0.9rem;">
              No hay comentarios r치pidos
            </p>
          </div>
        </div>

        <!-- Sides Section -->
        <div class="options-section" style="margin-top: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 600;">Acompa침antes</h4>
            <button class="btn-primary-small" id="addSideBtn">+ Agregar</button>
          </div>
          <div id="sidesListDashboard" class="options-list">
            <p class="empty-message" style="padding: 1rem; text-align: center; color: #9ca3af; font-size: 0.9rem;">
              No hay acompa침antes
            </p>
          </div>
        </div>

      </div>
      <div style="padding: 1.5rem; border-top: 1px solid var(--color-border);">
        <button class="btn-secondary" id="closeProductOptionsBtn" style="width: 100%;">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal para crear/editar opci칩n -->
  <div id="optionModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="optionModalTitle">Nueva Opci칩n</h3>
        <button class="modal-close" id="closeOptionModal">&times;</button>
      </div>
      <form id="optionForm" class="modal-form">
        <div class="form-group">
          <label for="optionNameInput">Nombre *</label>
          <input type="text" id="optionNameInput" required>
        </div>
        <div class="form-group" id="optionPriceGroup">
          <label for="optionPriceInput">Precio adicional</label>
          <input type="number" id="optionPriceInput" step="0.01" min="0" value="0">
          <small>Dejar en 0 si no tiene costo adicional</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelOptionBtn">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>



  <script type="module" src="./dashboard.js"></script>
</body>

</html>